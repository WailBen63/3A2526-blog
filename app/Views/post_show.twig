{# templates/post/show.twig #}
{# D√©tail de l'article et Commentaires - Conformit√© EF-ARTICLE-01, EF-COMMENT-01/02 #}

{% extends "base.twig" %}

{% block content %}
    {# Structure s√©mantique de l'article (EF-ARTICLE-01) #}
    <article class="mb-5">
        {# Image √† la une responsive (EF-ARTICLE-03) #}
        {% if post.image_une %}
            <div class="text-center mb-4">
                <img src="/3A2526-Blog/public/uploads/articles/{{ post.image_une }}" 
                     alt="{{ post.titre }}" class="img-fluid rounded shadow-sm"
                     style="max-height: 450px; width: 100%; object-fit: cover;">
            </div>
        {% endif %}
        
        <h1 class="display-5 fw-bold mb-3">{{ post.titre }}</h1>
        
        <div class="d-flex justify-content-between align-items-center text-muted border-bottom pb-3 mb-4">
            <span>üìÖ {{ post.date_creation|date("d/m/Y √† H:i") }} par <strong>{{ post.nom_utilisateur }}</strong></span>
            
            {# Tags cliquables (EF-ARTICLE-04) #}
            {% if post.tags %}
                <div>
                    {% for tag in post.tags %}
                        <a href="/3A2526-Blog/public/tag/{{ tag.id }}" class="badge bg-light text-secondary border text-decoration-none">
                            #{{ tag.nom_tag }}
                        </a>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        {# Rendu du contenu format√© (EF-ARTICLE-02) #}
        <div class="article-body fs-5">
            {{ post.contenu|raw }}
        </div>
    </article>

    <hr class="my-5">

    {# Syst√®me de Commentaires (EF-COMMENT-01/02) #}
    <section id="comments-section" class="mb-5">
        <h3 class="mb-4">Commentaires ({{ post.comments|length }})</h3>
        
        {# Formulaire de d√©p√¥t (EF-COMMENT-02) #}
        <div class="card border-0 bg-light shadow-sm mb-5">
            <div class="card-body p-4">
                <h5 class="card-title mb-3">Partagez votre avis</h5>
                <form action="/3A2526-Blog/public/comments/{{ post.id }}/store" method="POST">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="nom_auteur" class="form-label small fw-bold">Nom ou Pseudo *</label>
                            <input type="text" class="form-control" id="nom_auteur" name="nom_auteur" 
                                   value="{{ old_input.nom_auteur|default('') }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="email_auteur" class="form-label small fw-bold">Email (confidentiel)</label>
                            <input type="email" class="form-control" id="email_auteur" name="email_auteur" 
                                   value="{{ old_input.email_auteur|default('') }}">
                        </div>
                        <div class="col-12">
                            <label for="contenu" class="form-label small fw-bold">Votre message *</label>
                            <textarea class="form-control" id="contenu" name="contenu" rows="4" required>{{ old_input.contenu|default('') }}</textarea>
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> 
                                Votre message sera publi√© apr√®s validation par un mod√©rateur (EF-COMMENT-03).
                            </div>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary px-4">Publier le commentaire</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {# Liste des commentaires approuv√©s (EF-COMMENT-01) #}
        <div class="comments-list">
            {% for comment in post.comments %}
                <div class="d-flex mb-4 border-start border-4 border-primary-subtle ps-4">
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h6 class="fw-bold mb-0">{{ comment.nom_auteur }}</h6>
                            <small class="text-muted">{{ comment.date_commentaire|date("d/m/Y √† H:i") }}</small>
                        </div>
                        <p class="mb-0 text-secondary">{{ comment.contenu|nl2br }}</p>
                    </div>
                </div>
            {% else %}
                <div class="text-center py-4 text-muted border rounded bg-white">
                    <p class="mb-0">Aucun commentaire pour le moment. Soyez le premier √† r√©agir !</p>
                </div>
            {% endfor %}
        </div>
    </section>

    <div class="text-center py-4">
        <a href="/3A2526-Blog/public/" class="btn btn-outline-secondary">&larr; Retour √† la liste des articles</a>
    </div>
{% endblock %}