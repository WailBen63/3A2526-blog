{# templates/admin/tags/index.twig #}
{# 
    Liste des tags - Interface d'administration
    Implémente EF-TAG-01 (Lecture/Liste) et EF-TAG-02 (statistiques d'utilisation)
    
    Caractéristiques principales :
    - Tableau complet de tous les tags avec leurs statistiques
    - Indicateurs visuels d'utilisation (badges avec compteurs)
    - Actions CRUD (Modifier/Supprimer) pour chaque tag
    - Statistiques synthétiques sur l'utilisation des tags
    - Navigation rapide vers création et tableau de bord
    
    @package Templates/Admin
    @conformité EF-TAG-01 : Lecture et liste des tags (partie R du CRUD)
    @conformité EF-TAG-02 : Affichage des tags avec nombre d'articles associés
    @conformité EF-ADMIN-01 : Statistiques clés (tags utilisés/non utilisés)
    @conformité EF-ADMIN-02 : Navigation claire vers toutes les sections
    @conformité EF-ADMIN-03 : Vue d'ensemble du système de tags
    @conformité UX-RESPONSIVE-01/02 : Interface mobile-first et table responsive
    @conformité 2.1 Technologies : Twig 3.X, Bootstrap 5.X
#}

{% extends "base.twig" %}

{% block content %}
{# 
    En-tête de page avec titre et actions principales
    Design responsive avec flexbox Bootstrap
    Conformité EF-ADMIN-02 : Navigation claire et complète
#}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    {# 
        Titre de la page
        Variable page_title définie par le contrôleur
        Indique clairement la section de gestion des tags
    #}
    <h1 class="h2">{{ page_title }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        {# 
            Bouton de création de tag
            Positionné en haut à droite pour accès rapide
            Conformité EF-TAG-01 : Accès direct à la création
            Style primary (bleu) pour action principale
        #}
        <a href="/3A2526-Blog/public/admin/tags/create" class="btn btn-sm btn-outline-primary">
            + Nouveau tag
        </a>
        {# 
            Bouton de retour au tableau de bord
            Permet une navigation facile entre les sections
            Conformité EF-ADMIN-02 : Navigation intuitive
            ms-2 (margin-start) pour espacement sous Bootstrap 5
        #}
        <a href="/3A2526-Blog/public/admin" class="btn btn-sm btn-outline-secondary ms-2">
            ← Tableau de bord
        </a>
    </div>
</div>

{# 
    Section conditionnelle : Affichage des tags ou message vide
    Conformité UX : Feedback approprié selon l'état des données
#}
{% if tags %}
    {# 
        Table responsive pour s'adapter aux petits écrans
        Conformité UX-RESPONSIVE-02 : Table scrollable horizontalement
        Important pour les longs noms de tags ou slugs
    #}
    <div class="table-responsive">
        <table class="table table-striped table-sm">
            {# 
                En-tête du tableau avec colonnes informatives
                Conformité EF-TAG-02 : Informations complètes sur les tags
                Ordre logique : ID → Nom → Slug → Articles → Actions
            #}
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nom du tag</th>
                    <th>Slug</th>
                    <th>Articles associés</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {# 
                    Boucle sur tous les tags
                    Chaque ligne représente un tag avec ses métadonnées
                    Conformité EF-TAG-01 : Liste complète des tags
                #}
                {% for tag in tags %}
                <tr>
                    {# 
                        Colonne ID : Identifiant unique du tag
                        Utile pour le référencement technique et le débogage
                    #}
                    <td>{{ tag.id }}</td>
                    
                    {# 
                        Colonne Nom : Nom du tag avec badge stylisé
                        Conformité EF-TAG-01 : Affichage du nom du tag
                        Badge Bootstrap pour une identification visuelle rapide
                        Style secondary (gris) pour cohérence avec les tags d'articles
                    #}
                    <td>
                        <span class="badge bg-secondary">{{ tag.nom_tag }}</span>
                    </td>
                    
                    {# 
                        Colonne Slug : Version URL-friendly du nom
                        Conformité EF-TAG-01 : Affichage du slug pour URLs
                        Balise <code> pour indiquer qu'il s'agit d'un code/URL
                        Important pour le référencement et les liens permanents
                    #}
                    <td>
                        <code>{{ tag.slug }}</code>
                    </td>
                    
                    {# 
                        Colonne Articles associés : Nombre d'articles utilisant ce tag
                        Conformité EF-TAG-02 : Affichage du nombre d'articles associés
                        Badge info (bleu) pour les métriques quantitatives
                        Indicateur clé de l'utilité et de l'utilisation du tag
                    #}
                    <td>
                        <span class="badge bg-info">{{ tag.nb_articles }}</span>
                    </td>
                    
                    {# 
                        Colonne Actions : Boutons de gestion CRUD
                        Conformité EF-TAG-01 : Actions de modification/suppression
                        Interface compacte avec groupe de boutons
                    #}
                    <td>
                        {# 
                            Groupe de boutons pour actions connexes
                            Conformité Bootstrap : Groupement logique d'actions
                        #}
                        <div class="btn-group btn-group-sm" role="group">
                            {# 
                                Bouton Modifier : Accès au formulaire d'édition
                                Style warning (orange) pour action de modification
                                Lien avec ID spécifique du tag
                                Conformité EF-TAG-01 : Modification de tag
                            #}
                            <a href="/3A2526-Blog/public/admin/tags/{{ tag.id }}/edit" class="btn btn-outline-warning btn-sm">
                                Modifier
                            </a>
                            
                            {# 
                                Formulaire de suppression avec confirmation explicite
                                Sécurité : Méthode POST pour actions destructrices
                                UX : Confirmation avec message détaillé sur les conséquences
                                Conformité EF-TAG-01 : Suppression de tag
                                Important : Mention des associations qui seront supprimées
                            #}
                            <form action="/3A2526-Blog/public/admin/tags/{{ tag.id }}/delete" method="POST" class="d-inline" 
                                  onsubmit="return confirm('Supprimer ce tag ? Les associations avec les articles seront également supprimées.')">
                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                    Supprimer
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# 
        Section Statistiques : Vue synthétique de l'utilisation des tags
        Conformité EF-ADMIN-01 : Statistiques clés pour le gestionnaire
        Conformité EF-TAG-02 : Analyse de l'utilisation des tags
        Design avec cartes colorées Bootstrap en ligne
    #}
    <div class="row mt-4">
        {# 
            Carte : Total des tags
            Couleur primary (bleu) pour statistique globale
            Simple comptage de tous les tags existants
        #}
        <div class="col-md-4">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">{{ tags|length }}</h5>
                    <p class="card-text">Total tags</p>
                </div>
            </div>
        </div>
        
        {# 
            Carte : Tags utilisés (avec au moins un article)
            Couleur success (vert) pour indicateur positif
            Filtre Twig pour compter les tags avec nb_articles > 0
            Conformité EF-TAG-02 : Identification des tags actifs
        #}
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">{{ tags|filter(t => t.nb_articles > 0)|length }}</h5>
                    <p class="card-text">Tags utilisés</p>
                </div>
            </div>
        </div>
        
        {# 
            Carte : Tags non utilisés (sans article associé)
            Couleur warning (orange) pour indicateur d'attention
            Filtre Twig pour compter les tags avec nb_articles == 0
            Utile pour le nettoyage et l'optimisation
        #}
        <div class="col-md-4">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">{{ tags|filter(t => t.nb_articles == 0)|length }}</h5>
                    <p class="card-text">Tags non utilisés</p>
                </div>
            </div>
        </div>
    </div>
{% else %}
    {# 
        Message affiché quand il n'y a aucun tag
        Conformité UX : Message informatif et orienté vers l'action
        Style alert-info pour message neutre mais visible
        Inclut un titre et une description claire
    #}
    <div class="alert alert-info">
        <h4 class="alert-heading">Aucun tag</h4>
        <p class="mb-0">Aucun tag n'a été trouvé dans la base de données.</p>
    </div>
{% endif %}
{% endblock %}